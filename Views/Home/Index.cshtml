@model BGSWebApplication.Models.MasterDTO.ProjectMasterDTO

@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<style type="text/css">
    .pointer {
        cursor: pointer;
    }

    body {
        background-color: #A6A7CD;
        width: 100%;
        height: 600px;
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        margin: auto;
        padding: 0;
    }
</style>

<div class="" >

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <a href="/" class="brand-link">
            <i class="fas fa-calendar-check fa-2x brand-image elevation-0" style="opacity: .8;"></i>
            <span class="brand-text font-weight-light">Task App</span>
        </a>
        <div class="sidebar">
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <i class="fas fa-user fa-2x"></i>
                </div>
                <div class="info">
                    <a href="#" class="d-block">@ViewBag.username</a>
                </div>
            </div>
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                    <li class="nav-header">SHORTCUTS</li>
                    <li class="nav-item">
                        <a onclick="" class="nav-link">
                            <i class="nav-icon fas fa-calendar-day"></i>
                            <p>Todays Tasks</p>
                            <span class="badge badge-info right">
                                @if (Model.JsonDataToday.Count > 0)
                                {
                                    @Model.JsonDataToday.Count
                                }
                                else
                                {
                                    @Model.JsonDataToday.Count
                                }
                            </span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a onclick="" class="nav-link">
                            <i class="nav-icon fas fa-th"></i>
                            <p>All Tasks</p>
                            <span class="badge badge-info right">
                                @if (Model.TasksInfo.Count > 0)
                                {
                                    @Model.TasksInfo[0].TotalTasks
                                }
                                else
                                {
                                    @Model.TasksInfo.Count
                                }
                            </span>
                        </a>
                    </li>
                    <li class="nav-item menu-is-opening menu-open">
                        <a onclick="" class="nav-link">
                            <i class="nav-icon fas fa-chart-pie"></i>
                            <p>
                                Task Categories Info.
                                <i class="right fas fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a onclick="" class="nav-link">
                                    <i class="fas fa-bookmark" style="color:red;"></i>
                                    <p>Work</p>
                                    <span class="badge badge-info right">
                                        @if (Model.CategoryInfo.Count > 0)
                                        {
                                            @Model.CategoryInfo[0].Work
                                        }
                                        else
                                        {
                                        @Model.JsonDataToday.Count
                                        }
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a onclick="" class="nav-link">
                                    <i class="fas fa-bookmark" style="color:steelblue;"></i>
                                    <p>Personal</p>
                                    <span class="badge badge-info right">

                                        @if (Model.CategoryInfo.Count > 0)
                                        {
                                            @Model.CategoryInfo[0].Personal
                                        }
                                        else
                                        {
                                            @Model.JsonDataToday.Count
                                        }
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a onclick="" class="nav-link">
                                    <i class="fas fa-bookmark" style="color:orangered;"></i>
                                    <p>Shopping</p>
                                    <span class="badge badge-info right">
                                        @if (Model.CategoryInfo.Count > 0)
                                        {
                                            @Model.CategoryInfo[0].Shopping
                                        }
                                        else
                                        {
                                            @Model.JsonDataToday.Count
                                        }
                                    </span>
                                </a>
                            </li>                           
                        </ul>
                    </li>
                   
                </ul>
            </nav>
        </div>
    </aside>

    <aside class="control-sidebar control-sidebar-dark">
    </aside>
</div>

<nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">

        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a class="nav-link" data-widget="" data-toggle="modal" data-target="#modal-AddTask" href="#" role="button"><i class="fas fa-plus" style="color:rgb(0, 0, 0,0.5);"></i></a>
        </li>
      
    </ul>
    <ul class="navbar-nav ml-auto">


        <li class="nav-item">
            <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                <i class="fas fa-expand-arrows-alt"></i>
            </a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="right fas fa-angle-down"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                <a class="nav-link" data-widget="" href="#" role="button" onclick="Logout()">
                    <span>
                        Logout<i class="right fas fa-angle-right"> </i>
                    </span>
                </a>
            </div>
        </li>
    </ul>
</nav>


<div class="content-wrapper" style="padding:10px !important; background-color:transparent !important;">
    @* Todays Tasks *@
    <div class="card card-primary card-outline" id="todaytasksview">
        <div class="card-header" style="text-align:center;">
            <h3 class="card-title" style=" font-size: larger;">TASKS TODAY</h3>
        </div>
        <div class="card-body">
            @if (Model.JsonDataToday.Count > 0)
            {
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tasks to complete today <span class="badge badge-info right">@Model.JsonDataToday.Count</span></h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>


                    <div class="card-body p-0" style="display: block; padding-left:20px !important; background-color:coral;">
                        <table class="table table-hover table-striped" style="background-color:white;">
                            <tbody>
                                @for (int i = 0; i < Model.JsonDataToday.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            <i class="fas fa-bookmark" style="color:@Model.JsonDataToday[i].Color"></i>
                                        </td>

                                        <td class="mailbox-name"><a href="read-mail.html">Alexander Pierce</a></td>
                                        <td class="mailbox-subject">
                                            <b>@Model.JsonDataToday[i].Title</b> - @Model.JsonDataToday[i].Task
                                        </td>
                                        <td class="mailbox-attachment"></td>
                                        <td class="mailbox-date">@Model.JsonDataToday[i].AddedDate</td>
                                        <td class=""><a class="pointer" style="color:black;" onclick="DeleteTask('@Model.JsonDataToday[i].Id')"><i class="fas fa-trash"></i></a></td>
                                        <td class=""><a class="pointer" style="color:black;" onclick="EditTask('@Model.JsonDataToday[i].Id')"><i class="fas fa-edit"></i></a></td>

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
            else
            {
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tasks to complete today <span class="badge badge-info right">@Model.JsonDataToday.Count</span></h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0" style="display: block; padding-left:20px !important; background-color:coral;">
                        <table class="table table-hover table-striped" style="background-color:white;">
                            <tbody>
                                <tr>

                                    <td class="mailbox-subject" colspan="1">
                                        <b style="text-align:center;">No tasks today</b>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>

    @* All Tasks *@
    <div class="card card-primary card-outline" id="alltasksview">
        <div class="card-header" style="text-align:center;">
            <h3 class="card-title" style=" font-size: larger;">ALL TASKS</h3>
        </div>
        <div class="card-body">
            @if (Model.JsonDataAll.Count > 0)
            {
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tasks in total <span class="badge badge-info right">@Model.JsonDataAll.Count</span></h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>


                    <div class="card-body p-0" style="display: block; padding-left: 20px !important; background-color:#b78e7f;">
                        <table class="table table-hover table-striped" style="background-color:white;">
                            <tbody>
                                @for (int i = 0; i < Model.JsonDataAll.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            <i class="fas fa-bookmark" style="color:@Model.JsonDataAll[i].Color"></i>
                                        </td>
                                        <td class=""><a class="pointer" style="color:black;" onclick="ViewTask('@Model.JsonDataAll[i].Id')"><i class="right fas fa-angle-down"></i></a></td>
                                    <td class="mailbox-subject">
                                        <b>@Model.JsonDataAll[i].Title</b> - @Model.JsonDataAll[i].Task
                                    </td>
                                        <td class="mailbox-date">@Model.JsonDataAll[i].AddedDate</td>
                                        <td class=""><a class="pointer" style="color:black;" onclick="DeleteTask('@Model.JsonDataAll[i].Id')"><i class="fas fa-trash"></i></a></td>
                                        <td class=""><a class="pointer" style="color:black;" onclick="EditTask('@Model.JsonDataAll[i].Id')"><i class="fas fa-edit"></i></a></td>

                                    </tr>
                                <tr id="@Model.JsonDataAll[i].Id"></tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
            else
            {
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tasks in total <span class="badge badge-info right">@Model.JsonDataAll.Count</span></h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0" style="display: block; padding-left:20px !important; background-color:coral;">
                        <table class="table table-hover table-striped" style="background-color:white;">
                            <tbody>
                                <tr>

                                    <td class="mailbox-subject" colspan="1">
                                        <b style="text-align:center;">No tasks today</b>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>

</div>

@* ADD MODAL *@
<div class="modal fade" id="modal-AddTask" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add Task</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">

                <form action="/Home/AddTask" id="AddTaskForm" enctype="multipart/form-data" method="post">

                    <div class="card-body">


                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="Title">Title</label>
                                <input type="text" class="form-control" id="Title" placeholder="Enter title">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="Task">Task</label>
                                <input type="text" class="form-control" id="Task" placeholder="Enter task">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-8">
                                <label>Date:</label>
                                <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                    <input type="text" id="dateChosen" class="form-control datetimepicker-input" data-target="#reservationdate" />
                                    <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group  col-md-4">
                                <label for="Category">Category</label> <br/>

                                @Html.DropDownListFor(model => Model.Id, new SelectList(Model.Categories, "Id", "Category"), new { @id = "Category", @class = "dropdown" })

                            </div>

                        </div>
                        <div class="form-group">
                            <label for="Details">Details</label>
                            <textarea class="form-control" id="Details" name="Details" rows="4" cols="50"></textarea>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary" style="float:right;">Add Task</button>
                    </div>
                </form>
          

            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="modal-EditTask" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit Task</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">

                <form action="/Home/EditTaskFromForm" id="EditTaskForm" enctype="multipart/form-data" method="post">
           
                    <div class="card-body">
                       

                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="editTitle">Title</label>
                                <input type="text" class="form-control" id="editTitle" placeholder="Enter title">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="editTask">Task</label>
                                <input type="text" class="form-control" id="editTask" placeholder="Enter task">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-8">
                                <label>Date:</label>
                                <div class="input-group date" id="reservationdate2" data-target-input="nearest">
                                    <input type="text" id="editdateChosen" class="form-control datetimepicker-input" data-target="#reservationdate2" />
                                    <div class="input-group-append" data-target="#reservationdate2" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group  col-md-4">
                                <label for="Category">Category</label> <br/>

                                @Html.DropDownListFor(model => Model.Id, new SelectList(Model.Categories, "Id", "Category"), new { @id = "editCategory", @class = "dropdown" })

                            </div>

                        </div>
                        <div class="form-group">
                            <label for="Details">Details</label>
                            <textarea class="form-control" id="editDetails" name="Details" rows="4" cols="50"></textarea>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary" style="float:right;">Edit Task</button>
                    </div>
                </form>
            </div>
          
        </div>
    </div>
</div>

<div class="modal fade" id="modal-ViewTask" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">view Task</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">

              
                    <div class="card-body">
                      
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="Title">Title</label>
                                <input type="text" class="form-control" id="viewTitle" placeholder="Enter title">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="Task">Task</label>
                                <input type="text" class="form-control" id="viewTaskin" placeholder="Enter task">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-8">
                                <label>Date:</label>
                                <div class="input-group date" id="reservationdate2" data-target-input="nearest">
                                    <input type="text" id="viewdateChosen" class="form-control datetimepicker-input" data-target="#reservationdate2" />
                                    <div class="input-group-append" data-target="#reservationdate2" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group  col-md-4">
                                <label for="Category">Category</label> <br />

                                <label for="Category">Task</label>
                                <input type="text" class="form-control" id="viewCategory" placeholder="Category">
                            </div>

                        </div>
                        <div class="form-group">
                            <label for="Details">Details</label>
                            <textarea class="form-control" id="viewDetails" name="Details" rows="4" cols="50"></textarea>
                        </div>
                    </div>

             
            </div>
           
        </div>
    </div>
</div>


<div role="alert" aria-live="assertive" aria-atomic="true" class="toast" data-autohide="true">
    <div class="toast-header">
        <img src="..." class="rounded mr-2" alt="...">
        <strong class="mr-auto">Bootstrap</strong>
        <small>11 mins ago</small>
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="toast-body">
        Hello, world! This is a toast message.
    </div>
</div>

<script src="~/Theme/AdminLTE/plugins/jquery/jquery.min.js"></script>
<script src="~/Theme/AdminLTE/plugins/jquery-ui/jquery-ui.min.js"></script>

<script type="text/javascript">

    var chosenGuidToEdit = "";
    var busy = false;
    var busygid = "";


    function ViewTask(gid) {

        $.ajax({
            url: "/Home/EditTask",
            type: "post",
            data: { guidId: gid },
            success: function (data) {
               
                    if (busy === false) {
                        busy = true;

                        const contentBelow1 = document.getElementById(gid);
                        const setHTML1 = '<td style="background-color:#e7d0d0;"> "' + data.AddedDate + '"</td>';
                        const setHTML2 = '<td colspan="5"  style="background-color:#e7d0d0;"><div class="callout callout-info" style="border-left-color:' + data.Color + ';"><h5>"' + data.Title + '"</h5><h5>"' + data.Task + '"</h5><h5>"' + data.Details + '"</h5><h5>"' + data.Date + '"</h5><p>""</p></div ></td>';
                        contentBelow1.innerHTML = setHTML1 + setHTML2;
                    } else if (busy === true) {
                        if (busygid != gid) {
                            contentBelow2 = document.getElementById(busygid);
                            setHTML2 = '';
                            contentBelow2.innerHTML = setHTML2;

                            contentBelow11 = document.getElementById(gid);
                            const setHTML11 = '<td style="background-color:#e7d0d0;"> "' + data.AddedDate + '"</td>';
                            const setHTML22 = '<td colspan="5" style="background-color:#e7d0d0;"><div class="callout callout-info" style="border-left-color:' + data.Color + ';"><h5>"' + data.Title + '"</h5><h5>"' + data.Task + '"</h5><h5>"' + data.Details + '"</h5><h5>"' + data.Date + '"</h5><p>""</p></div ></td>';
                            contentBelow11.innerHTML = setHTML11 + setHTML22;

                        } else if (busygid === gid) {
                            contentBelow4 = document.getElementById(gid);
                            setHTML4 = '';
                            contentBelow4.innerHTML = setHTML4;
                        }

                    }
                busygid = gid;
            },
            fail: function (xhr, textStatus, errorThrown) {
            }
        });
    }

    function EditTask(gid) {

        $.ajax({
            url: "/Home/EditTask",
            type: "post",
            data: { guidId: gid },
            success: function (data) {
                    chosenGuidToEdit = gid;
                    document.getElementById('editTitle').value = data.Title;
                    document.getElementById('editCategory').value = data.Category;
                    document.getElementById('editDetails').value = data.Details;
                    document.getElementById('editTask').value = data.Task;
                    document.getElementById('editdateChosen').value = data.Date;

                    $("#modal-EditTask").modal("show");
              
            },
            fail: function (xhr, textStatus, errorThrown) {
            }
        });
    }

    function DeleteTask(gid) {

        $.ajax({
            url: "/Home/DeleteTask",
            type: "post",
            data: { guidId: gid },
            success: function (data) {
                if (data.success === true) {
                    location.reload();
                } else if (data.success === false) {
                }
            },
            fail: function (xhr, textStatus, errorThrown) {
            }
        });
    }

    $(function () {

        //Date picker
        $('#reservationdate').datetimepicker({
            format: 'L'
        });
        //Date picker
        $('#reservationdate2').datetimepicker({
            format: 'L'
        });

        //Date range picker
        $('#reservation').daterangepicker()
        //Date range picker with time picker

        //Date range as a button
        $('#daterange-btn').daterangepicker(
            {
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                startDate: moment().subtract(29, 'days'),
                endDate: moment()
            },
            function (start, end) {
                $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))
            }
        )

    })

    function Logout() {
        $.ajax({
            url: "/Home/Logout",
            type: "post",
            success: function (data) {
                if (data.success === true) {
                    window.location.href = '@Url.Action("Login", "Account")';
                } else if (data.success === false) {
                     window.location.href = '@Url.Action("Login", "Account")';
                }
            },
            fail: function (xhr, textStatus, errorThrown) {
            }
        });
    }

    $("#AddTaskForm").submit(function (e) {
        e.preventDefault();

        var dateVal = $("#dateChosen").val();

        var TitleCheck = true;
        var TaskCheck = true;
        var DateCheck = true;

        var Category = document.getElementById('Category');
        var Details = document.getElementById('Details');

        var Title = document.getElementById('Title');
        if (Title.value === "") {
            Title.classList.add("showError");
            TitleCheck = false;
        }

        var Task = document.getElementById('Task');
        if (Task.value === "") {
            Task.classList.add("showError");
            TaskCheck = false;
        }

        if (Details.value === "") {
            Details.value ="_";
        }

        if (dateVal === "") {
            DateCheck = false;
        }


        if (TitleCheck === true && TaskCheck === true && DateCheck === true) {
            $.ajax({
                url: "/Home/AddTask",
                type: "post",
                data: { Category: Category.value, Title: Title.value, Details: Details.value, Task: Task.value, Date: dateVal },
                success: function (data) {
                    if (data.success === true) {
                        location.reload();
                    } else if (data.success === false) {
                    }
                },
                fail: function (xhr, textStatus, errorThrown) {
                }
            });
        } else {
        }
    });


    $("#EditTaskForm").submit(function (e) {

        e.preventDefault();

        var dateVal = $("#editdateChosen").val();

        var TitleCheck = true;
        var TaskCheck = true;
        var DateCheck = true;

        var Category = document.getElementById('editCategory');
        var Details = document.getElementById('editDetails');

        var Title = document.getElementById('editTitle');
        if (Title.value === "") {
            Title.classList.add("showError");
            TitleCheck = false;
        }

        var Task = document.getElementById('editTask');
        if (Task.value === "") {
            Task.classList.add("showError");
            TaskCheck = false;
        }

        if (Details.value === "") {
            Details.value = "_";
        }

        if (dateVal === "") {
            DateCheck = false;
        }


        if (TitleCheck === true && TaskCheck === true && DateCheck === true) {
            $.ajax({
                url: "/Home/EditTaskFromForm",
                type: "post",
                data: { Category: Category.value, Title: Title.value, Details: Details.value, Task: Task.value, Date: dateVal, Id: chosenGuidToEdit },
                success: function (data) {
                    if (data.success === true) {
                        location.reload();
                    } else if (data.success === false) {
                    }
                },
                fail: function (xhr, textStatus, errorThrown) {
                }
            });
        } else {
        }
    });
</script>
